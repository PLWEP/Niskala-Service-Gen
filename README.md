# Niskala Service Gen

A Dart code generator that creates strongly-typed API services using Dio from OpenAPI/OData metadata. This package is designed to work seamlessly with models generated by `niskala_model_gen`.

## Features

- **Controller Generation**: Paginated `AsyncNotifier` controllers with `$top`/`$skip`, search, filter, loadMore, and refresh.
- **Unified Providers Hub**: Single `providers.dart` generation with shared `apiClientProvider`, `ODataEncodingInterceptor`, and all service providers.
- **OData Filter Builder**: Type-safe `$filter` expression builder with IFS Cloud enum support and multi-select OR logic.
- **Linter-First**: 100% compliant with `very_good_analysis` with zero warnings in both generator and emitted code.
- **Structured Exception System**: Comprehensive hierarchy of exceptions (`NiskalaApiException`, `NiskalaNetworkException`, `NiskalaAuthException`) for robust error management.
- **Offline Resilience**: Pluggable `NiskalaCacheAdapter` system with a default `InMemoryCacheAdapter`.
- **Advanced Querying & Batching**: fluent `ODataQuery` builder and initial support for OData `$batch` operations.
- **Framework Alignment**: Unified `ConfigLoader`, `CodeMerger`, and `OpenApiLoader` logic across the entire Niskala ecosystem.

## Installation

Add this package to your `pubspec.yaml`:

```yaml
dev_dependencies:
    niskala_service_gen:
  version: "v1.0.0"
```

For a complete working example, see the [Niskala Framework Example](../Niskala%20Framework%20Example) directory at the project root.

## Configuration

The generator uses `niskala.yaml` for configuration. Add your environments and service definitions:

```yaml
odataEnvironments:
    - name: "Development"
      baseUrl: "https://ifsdev.example.com/"
      realms: "ifsrealm"
      clientId: "IFS_connect"
      clientSecret: "your_secret"

niskala_gen:
    resource_path: ./metadata
    output: lib

apiDefinitions:
    - projection: "PurchaseRequisitionHandling.svc"
      method: "POST"
      endpoint: "/PurchaseRequisitionSet"
```

## Usage

1. Run the generator:

    ```bash
    dart run niskala_service_gen --config niskala.yaml
    ```

2. Initialize the `ApiClient` and login:

    ```dart
    final client = ApiClient(); // Uses default environment
    await client.login('username', 'password');

    final service = PurchaseRequisitionService(client);
    final data = await service.getAll();
    ```

## Project Structure

- `lib/service/providers.dart`: Unified Riverpod providers registry (replaces per-service riverpod files).
- `lib/service/api/api_client.dart`: The global API client configuration.
- `lib/service/api/odata_query.dart`: Utility for building OData queries.
- `lib/service/api/odata_filter_builder.dart`: Type-safe `$filter` builder for OData APIs.
- `lib/service/api/[entity]_service.dart`: The main service class where you can add custom logic.
- `lib/service/api/[entity]_service.niskala.dart`: The generated base class.
- `lib/controllers/[entity]_controller.dart`: High-level generated data controllers.

## License

MIT
